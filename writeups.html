<div class="page slide-up">
  <h2>Write-ups</h2>
  <input id="searchBar" type="text" placeholder="Search write-ups…" style="width:100%;padding:8px;margin:10px 0;">
  <div id="writeupsContainer"></div>
  <div id="pagination" style="margin-top:20px;text-align:center;"></div>
</div>

<script>
async function loadWriteups() {
  try {
    const res = await fetch("/writeups.json");
    const posts = await res.json();

    let filtered = posts;
    let currentPage = 1;
    const perPage = 5;

    const container = document.getElementById("writeupsContainer");
    const pagination = document.getElementById("pagination");
    const searchBar = document.getElementById("searchBar");

    function readingTime(text) {
      const words = text.trim().split(/\s+/).length;
      return Math.ceil(words / 150) + " min read"; 
    }

    function render() {
      const start = (currentPage - 1) * perPage;
      const pageItems = filtered.slice(start, start + perPage);

      container.innerHTML = pageItems.map(p => `
        <div class="card" style="border:1px dashed #aaa;padding:15px;margin-bottom:15px;border-radius:10px;">
          <h3>${p.title}</h3>
          <small>${new Date(p.date).toDateString()} • ${readingTime(p.content)}</small>
          <p>${p.summary}</p>
          <a href="read.html?id=${p.id}" class="read-more">Read more →</a>
        </div>
      `).join("");

      const totalPages = Math.ceil(filtered.length / perPage);
      pagination.innerHTML = `
        <button onclick="prevPage()" ${currentPage==1?"disabled":""}>Prev</button>
        <span style="margin:0 10px">${currentPage} / ${totalPages}</span>
        <button onclick="nextPage()" ${currentPage==totalPages?"disabled":""}>Next</button>
      `;
    }

    window.prevPage = () => { if (currentPage > 1) { currentPage--; render(); } };
    window.nextPage = () => { 
      const totalPages = Math.ceil(filtered.length / perPage);
      if (currentPage < totalPages) { currentPage++; render(); } 
    };

    searchBar.addEventListener("input", () => {
      const q = searchBar.value.toLowerCase();
      filtered = posts.filter(p => p.title.toLowerCase().includes(q) || p.summary.toLowerCase().includes(q));
      currentPage = 1;
      render();
    });

    render();
  } catch (err) {
    document.getElementById("writeupsContainer").innerHTML = "<p>Could not load write-ups.</p>";
  }
}

loadWriteups();
</script>
