<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>About | Solasaki Comics</title>

  <!-- Main CSS -->
  <link rel="stylesheet" href="style.css">

  <style>
    /* Small page-specific tweaks that live alongside style.css */
    .page { max-width: 900px; margin: auto; padding: 22px; }
    .sketch-wrapper {
      margin-top: 22px;
      padding: 14px;
      border: 2px dashed var(--border);
      background: #fffef9;
      border-radius: 12px;
    }
    #drawCanvas {
      width: 100%;
      height: 340px;
      display: block;
      border-radius: 10px;
      background: #fffdf7;
      touch-action: none;
    }
    .sketch-controls {
      margin-top: 15px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .sketch-controls button {
      padding: 10px 16px;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      font-family: "Patrick Hand";
      border: none;
      cursor: pointer;
      font-size: 17px;
    }
    .tool-secondary {
      background: #fff;
      color: #333;
      border: 1px solid var(--border);
    }
    .doodle-wall {
      margin-top: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 14px;
    }
    .doodle-sticker {
      width: 100%;
      max-width: 120px;
      background: white;
      padding: 8px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .doodle-sticker img {
      width: 100%;
      border-radius: 6px;
      display:block;
    }

    /* Admin delete button style */
    .delete-btn {
      margin-top: 6px;
      padding: 6px 10px;
      font-size: 13px;
      border: 1px dashed #c33;
      background: #fff0f0;
      color: #a00;
      border-radius: 6px;
      cursor: pointer;
    }
    .delete-btn:hover { background: #ffd6d6; }

    /* small saved message */
    #saveMsg { font-size: 13px; color: var(--muted); margin-left: 8px; display:inline-block; vertical-align:middle; }

    /* keep header toggle aligned on mobile like other pages */
    .toggle-mode {
      margin-left: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 2px dashed var(--border);
      background: rgba(255,255,255,0.9);
      cursor:pointer;
    }
  </style>
</head>
<body class="fade">

  <header>
    <div class="logoarea">
      <img src="assets/uploads/IMG_0079.jpeg" alt="logo">
      <h1>Solasaki Comics</h1>
    </div>

    <nav>
      <a href="index.html">Home</a>
      <a href="comics.html">Comics</a>
      <a href="writeups.html">Write-ups</a>
      <a class="active" href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>

    <!-- Night mode toggle (keeps original behavior using documentElement.classList) -->
    <button class="toggle-mode" onclick="toggleMode()">üåô</button>
  </header>

  <div class="page slide-up">
    <h2>About</h2>

    <p>Hello! Welcome to the yellow world. I'm Surbhi ‚Äî creator of Solasaki Comics.
      I make simple comics inspired by my weird observations. You can also read my writeups if you have nothing better to do.</p>

    <h3>Draw something ‚Äî visitors doodle board</h3>

    <div class="sketch-wrapper">
      <canvas id="drawCanvas"></canvas>

      <div class="sketch-controls">
        <button id="pencilBtn">‚úèÔ∏è Pencil</button>
        <button id="eraserBtn" class="tool-secondary">üßΩ Eraser</button>
        <button id="undoBtn" class="tool-secondary">‚Ü©Ô∏è Undo</button>
        <button id="clearBtn" class="tool-secondary">üßπ Clear</button>
        <button id="saveBtn">Save Doodle</button>
        <span id="saveMsg"></span>
      </div>
    </div>

    <h3 style="margin-top:28px">Visitors‚Äô doodles</h3>
    <div id="doodleGrid" class="doodle-wall" aria-live="polite"></div>

  </div>

  <footer>
    <p>¬© 2025 Solasaki Comics</p>
  </footer>

  <!-- Instagram or other scripts if needed (kept out to avoid duplication) -->

  <!-- -------------------
       SCRIPT: Canvas + Supabase + Admin Delete
       ------------------- -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const supabase = createClient(
      "https://rgxtvwnfqglsxnmvkkus.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJneHR2d25mcWdsc3hubXZra3VzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NjEwNzksImV4cCI6MjA4MDMzNzA3OX0.twtdhIMF4xnaBQsird8CyEb3g3Kh8bI5REChohdyGwo"
    );

    // Admin flag (reads localStorage)
    const isAdmin = localStorage.getItem("admin") === "yes";

    /* Canvas Setup */
    const canvas = document.getElementById("drawCanvas");
    const ctx = canvas.getContext("2d");

    function resizeCanvas(){
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
      redraw();
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    let drawing = false;
    let erasing = false;
    let strokes = [];
    let currentStroke = [];

    function pos(e){
      const r = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - r.top;
      return {x,y};
    }

    function start(e){
      drawing = true;
      ctx.beginPath();
      const {x,y} = pos(e);
      ctx.moveTo(x,y);
      currentStroke = [{x,y,erasing}];
    }

    function move(e){
      if(!drawing) return;
      const {x,y} = pos(e);
      ctx.lineWidth = erasing ? 18 : 3;
      ctx.strokeStyle = erasing ? "#fdf9f3" : "#000";
      ctx.lineTo(x,y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x,y);
      currentStroke.push({x,y,erasing});
    }

    function stop(){
      drawing = false;
      if(currentStroke.length) strokes.push(currentStroke);
    }

    // Mouse
    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", move);
    canvas.addEventListener("mouseup", stop);
    canvas.addEventListener("mouseleave", stop);
    // Touch
    canvas.addEventListener("touchstart", start, {passive:false});
    canvas.addEventListener("touchmove", move, {passive:false});
    canvas.addEventListener("touchend", stop);

    document.getElementById("pencilBtn").onclick = ()=> erasing = false;
    document.getElementById("eraserBtn").onclick = ()=> erasing = true;

    document.getElementById("undoBtn").onclick = ()=>{
      strokes.pop();
      ctx.clearRect(0,0,canvas.width,canvas.height);
      redraw();
    };

    document.getElementById("clearBtn").onclick = ()=>{
      strokes = [];
      ctx.clearRect(0,0,canvas.width,canvas.height);
    };

    function redraw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let s of strokes){
        ctx.beginPath();
        for(let i=0;i<s.length;i++){
          ctx.lineWidth = s[i].erasing ? 18 : 3;
          ctx.strokeStyle = s[i].erasing ? "#fdf9f3" : "#000";
          if(i===0) ctx.moveTo(s[i].x,s[i].y);
          else ctx.lineTo(s[i].x,s[i].y);
          ctx.stroke();
        }
      }
    }

    const messages = [
      "That one is actually pretty!",
      "Artist appreciates this one ‚ù§Ô∏è",
      "Ahhh‚Ä¶ try better maybe?",
      "World has never seen such an artist (please never draw again).",
      "The moon criticises this one.",
      "This doodle has strong 'why though?' energy.",
      "Beautiful. No one will understand it, ever.",
      "This belongs in a museum. A very small one.",
      "Even Yellow criticizes this one."
    ];
    function randomMsg(){ return messages[Math.floor(Math.random()*messages.length)]; }

    /* Bucket auto-delete oldest when > 50MB */
    async function enforceLimit(){
      const { data } = await supabase.storage.from("doodles").list("", {
        limit: 2000,
        sortBy: { column: "created_at", order: "asc" }
      });
      if(!data) return;

      let total = data.reduce((x,f)=> x + (f.size||0), 0);
      const LIMIT = 50 * 1024 * 1024;
      while(total > LIMIT && data.length){
        const oldest = data.shift();
        await supabase.storage.from("doodles").remove([oldest.name]);
        total -= oldest.size || 0;
      }
    }

    /* Save doodle */
    document.getElementById("saveBtn").onclick = async ()=>{
      document.getElementById("saveMsg").textContent = "Saving‚Ä¶";
      await enforceLimit();

      canvas.toBlob(async (blob)=>{
        const name = `doodle-${Date.now()}.png`;
        const { error } = await supabase.storage.from("doodles").upload(name, blob);

        if(error){
          document.getElementById("saveMsg").textContent = "Save failed!";
          alert("Error saving doodle.");
        } else {
          document.getElementById("saveMsg").textContent = randomMsg();
          loadDoodles();
        }
      });
    };

    /* Load doodles (admin sees delete button) */
    async function loadDoodles(){
      const { data } = await supabase.storage.from("doodles").list("", {
        limit: 200,
        sortBy: { column:"created_at", order:"desc" }
      });
      const grid = document.getElementById("doodleGrid");
      grid.innerHTML = "";

      (data || []).forEach(file => {
        const url = `https://rgxtvwnfqglsxnmvkkus.supabase.co/storage/v1/object/public/doodles/${file.name}`;
        const wrap = document.createElement("div");
        wrap.className = "doodle-sticker";

        const img = document.createElement("img");
        img.src = url;
        img.alt = "visitor doodle";

        wrap.appendChild(img);

        // Only admin sees delete control
        if(isAdmin){
          const del = document.createElement("button");
          del.className = "delete-btn";
          del.textContent = "‚ùå Delete";
          del.onclick = () => deleteDoodle(file.name);
          wrap.appendChild(del);
        }

        grid.appendChild(wrap);
      });
    }

    /* Delete doodle (admin only) */
    async function deleteDoodle(name){
      if(!confirm("Delete this doodle forever?")) return;
      const { error } = await supabase.storage.from("doodles").remove([name]);
      if(error){
        alert("Delete failed!");
      } else {
        loadDoodles();
      }
    }

    // initial load
    loadDoodles();

  </script>

  <!-- Dark mode toggle script: using documentElement.class (original behavior) -->
  <script>
    function toggleMode() {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem("mode",
        document.documentElement.classList.contains("dark") ? "dark" : "light"
      );
    }

    // Apply saved mode on load
    if (localStorage.getItem("mode") === "dark") {
      document.documentElement.classList.add("dark");
    }
  </script>
</body>
</html>
