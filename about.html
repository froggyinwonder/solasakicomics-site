<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About | Solasaki Comics</title>
    <link rel="stylesheet" href="style.css">

    <style>
        .draw-container {
            width: 100%;
            max-width: 900px;
            margin: 20px auto;
            background: #faf7ef;
            border: 2px dashed #d8cfc4;
            border-radius: 12px;
            padding: 10px;
        }

        #drawCanvas {
            width: 100%;
            height: 380px;
            background: #fdf9f3;
            border-radius: 8px;
            touch-action: none;
        }

        .tool-buttons {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .tool-buttons button {
            padding: 10px 18px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

        .save-btn {
            background: #b48fd5;
            color: white;
        }

        .tool-btn {
            background: #eee;
        }
    </style>
</head>

<body>
    <header>
        <a href="index.html"><h1>Solasaki Comics</h1></a>
        <nav>
            <a href="index.html">Home</a>
            <a href="comics.html">Comics</a>
            <a href="writeups.html">Write-ups</a>
            <a class="active" href="#">About</a>
            <a href="contact.html">Contact</a>
        </nav>
    </header>

    <main>
        <h2>About</h2>

        <p>Hello! Welcome to the yellow world. I'm Surbhi ‚Äî creator of Solasaki Comics.  
        I make simple comics inspired by my weird observations.  
        You can also read my writeups if you have nothing better to do.</p>

        <h3>Draw something for the artist or for yourself!!</h3>

        <div class="draw-container">
            <canvas id="drawCanvas"></canvas>

            <div class="tool-buttons">
                <button class="tool-btn" id="pencilBtn">‚úèÔ∏è Pencil</button>
                <button class="tool-btn" id="eraserBtn">üßΩ Eraser</button>
                <button class="tool-btn" id="undoBtn">‚Ü©Ô∏è Undo</button>
                <button class="save-btn" id="saveBtn">Save Doodle</button>
            </div>
        </div>

        <h3>Visitors' doodles</h3>
        <div id="doodlesGrid" class="doodles-grid"></div>
    </main>

    <footer>
        <p>¬© 2025 Solasaki Comics</p>
    </footer>

    <!-- Supabase Client -->
    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

        const supabase = createClient(
            "https://rgxtvwnfqglsxnmvkkus.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJneHR2d25mcWdsc3hubXZra3VzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NjEwNzksImV4cCI6MjA4MDMzNzA3OX0.twtdhIMF4xnaBQsird8CyEb3g3Kh8bI5REChohdyGwo"
        );

        // Canvas Setup
        const canvas = document.getElementById("drawCanvas");
        const ctx = canvas.getContext("2d");

        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        let drawing = false;
        let erasing = false;
        let strokes = [];
        let currentStroke = [];

        function startDraw(e) {
            drawing = true;
            currentStroke = [];
            draw(e);
        }

        function endDraw() {
            drawing = false;
            if (currentStroke.length > 0) strokes.push(currentStroke);
        }

        function draw(e) {
            if (!drawing) return;

            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

            ctx.lineWidth = erasing ? 18 : 3;
            ctx.lineCap = "round";
            ctx.strokeStyle = erasing ? "#fdf9f3" : "#333";

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);

            currentStroke.push({ x, y, erasing });
        }

        canvas.addEventListener("mousedown", startDraw);
        canvas.addEventListener("mouseup", endDraw);
        canvas.addEventListener("mousemove", draw);

        canvas.addEventListener("touchstart", startDraw);
        canvas.addEventListener("touchend", endDraw);
        canvas.addEventListener("touchmove", draw);

        // Tools
        document.getElementById("pencilBtn").onclick = () => { erasing = false; };
        document.getElementById("eraserBtn").onclick = () => { erasing = true; };

        document.getElementById("undoBtn").onclick = () => {
            strokes.pop();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            redraw();
        };

        function redraw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let stroke of strokes) {
                ctx.beginPath();
                for (let i = 0; i < stroke.length; i++) {
                    ctx.lineWidth = stroke[i].erasing ? 18 : 3;
                    ctx.strokeStyle = stroke[i].erasing ? "#fdf9f3" : "#333";
                    if (i === 0) ctx.moveTo(stroke[i].x, stroke[i].y);
                    else ctx.lineTo(stroke[i].x, stroke[i].y);
                    ctx.stroke();
                }
            }
            ctx.beginPath();
        }

        // Save to Supabase
        document.getElementById("saveBtn").onclick = async () => {
            canvas.toBlob(async (blob) => {
                const fileName = `doodle-${Date.now()}.png`;

                const { error } = await supabase.storage
                    .from("doodles")
                    .upload(fileName, blob);

                if (error) alert("Error saving doodle!");
                else alert("Doodle saved!");
            });
        };

        // Load doodles grid
        async function loadDoodles() {
            const { data } = await supabase.storage.from("doodles").list();

            const grid = document.getElementById("doodlesGrid");
            grid.innerHTML = "";

            data.reverse().forEach(file => {
                const url =
                    `https://rgxtvwnfqglsxnmvkkus.supabase.co/storage/v1/object/public/doodles/${file.name}`;

                const img = document.createElement("img");
                img.src = url;
                img.className = "doodle-thumb";

                grid.appendChild(img);
            });
        }

        loadDoodles();
    </script>

</body>
</html>
