<!doctype html>
<html>
<head>
  <title>About — Solasaki Comics</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #sketchpad {
      width: 100%;
      max-width: 500px;
      height: 300px;
      border: 2px dashed #ccc;
      border-radius: 12px;
      background: #fff;
      touch-action: none;
    }

    #saveDoodle {
      margin-top: 12px;
      padding: 10px 20px;
      background: #d9b3ff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    #doodleList {
      margin-top: 25px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .tiny-doodle {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
  </style>
</head>

<body class="fade">

<header>
  <div class="logoarea">
    <img src="assets/uploads/IMG_0079.jpeg">
    <h1>Solasaki Comics</h1>
  </div>

  <nav>
    <a href="index.html">Home</a>
    <a href="comics.html">Comics</a>
    <a href="writeups.html">Write-ups</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>
</header>

<div class="page slide-up">

  <h2>About</h2>

  <p>Hello! Welcome to the yellow world. I'm Surbhi — creator of Solasaki Comics.<br>
  I make simple comics inspired by my weird observations.<br>
  You can also read my writeups if you have nothing better to do.</p>

  <h3>Draw something!</h3>

  <canvas id="sketchpad" width="500" height="300"></canvas>
  <br>
  <button id="saveDoodle">Save Doodle</button>

  <h3>Visitors' doodles</h3>
  <div id="doodleList"></div>

</div>

<footer>© 2025 Solasaki Comics</footer>


<!-- ✅ DOODLES + SUPABASE SCRIPT -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

// ⭐ Replace with your actual values (you already shared them)
const SUPABASE_URL = "https://rgxtvwnfqglsxnmvkkus.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJneHR2d25mcWdsc3hubXZra3VzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ3NjEwNzksImV4cCI6MjA4MDMzNzA3OX0.twtdhIMF4xnaBQsird8CyEb3g3Kh8bI5REChohdyGwo";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

const MAX_DOODLES = 20; // ⭐ Doodles auto-delete when more than this

// HTML elements
const canvas = document.getElementById("sketchpad");
const ctx = canvas.getContext("2d", { willReadFrequently: true });
const saveBtn = document.getElementById("saveDoodle");
const listArea = document.getElementById("doodleList");

let drawing = false;

// --- DRAWING SETUP ---
canvas.addEventListener("mousedown", start);
canvas.addEventListener("mouseup", stop);
canvas.addEventListener("mouseout", stop);
canvas.addEventListener("mousemove", draw);

canvas.addEventListener("touchstart", e => start(e.touches[0]));
canvas.addEventListener("touchend", stop);
canvas.addEventListener("touchmove", e => draw(e.touches[0]));

function start(e) {
  drawing = true;
  draw(e);
}

function stop() {
  drawing = false;
  ctx.beginPath();
}

function draw(e) {
  if (!drawing) return;

  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  ctx.lineWidth = 4;
  ctx.lineCap = "round";
  ctx.strokeStyle = "#000";

  ctx.lineTo(x, y);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(x, y);
}

// --- SAVE DOODLE ---
function canvasToBlob() {
  return new Promise(res => {
    canvas.toBlob(b => res(b), "image/png");
  });
}

async function saveDoodle() {
  const blob = await canvasToBlob();
  const filename = `doodle-${Date.now()}.png`;

  const { error } = await supabase.storage
    .from("doodles")
    .upload(filename, blob);

  if (error) {
    alert("Error saving doodle!");
    return;
  }

  await enforceLimit(); // ⭐ delete old doodles
  await loadDoodles();  // refresh list
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  alert("Saved!");
}

// --- LIMIT STORAGE TO 20 DOODLES ---
async function enforceLimit() {
  const { data: files } = await supabase
    .storage
    .from("doodles")
    .list("", { sortBy: { column: "created_at", order: "asc" } });

  if (!files || files.length <= MAX_DOODLES) return;

  const extra = files.length - MAX_DOODLES;

  for (let i = 0; i < extra; i++) {
    await supabase.storage.from("doodles").remove([files[i].name]);
  }
}

// --- LOAD DOODLES ---
async function loadDoodles() {
  listArea.innerHTML = "";

  const { data: files } = await supabase
    .storage
    .from("doodles")
    .list("", { sortBy: { column: "created_at", order: "desc" } });

  files?.forEach(f => {
    const url = supabase.storage.from("doodles").getPublicUrl(f.name).data.publicUrl;
    const img = document.createElement("img");
    img.src = url;
    img.className = "tiny-doodle";
    listArea.appendChild(img);
  });
}

saveBtn.onclick = saveDoodle;
loadDoodles();

</script>

</body>
</html>
